@page "/categories"
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject HttpClient Http @* Används för att anropa API *@

<PageTitle>Kategorier</PageTitle>

<div class="categories-container">
    <h2>🛡️ Välj en kategori</h2>

    @* Visar laddningstext medan API-anropet pågår *@
    @if (categories == null)
    {
        <p>Laddar kategorier...</p>
    }
    else
    {
        @* Loopar igenom listan och skapar ett kort per kategori *@
        @foreach (var category in categories)
        {
            @* true = "locked" → nedtonat, false = "unlocked" → klickbart *@
            <div class="category-card @(category.IsLocked ? "locked" : "unlocked")"
                 @onclick="() => OnCategoryClick(category)">

                @* Hänglås visas bara om kategorin är låst *@
                @if (category.IsLocked)
                {
                    <span class="lock-icon">🔒</span>
                }

                <h3>@category.Name</h3>
                <p>30 frågor</p>

            </div>
        }
    }
</div>

<style>
    .categories-container {
        max-width: 500px;
        margin: 2rem auto;
        padding: 1rem;
    }

        .categories-container h2 {
            margin-bottom: 1.5rem;
        }

    .category-card {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        cursor: pointer;
    }

        .category-card.unlocked:hover {
            border-color: #7c3aed;
            background-color: #f3f0ff;
        }

        .category-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .category-card h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .category-card p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

    .lock-icon {
        font-size: 1.2rem;
    }
</style>

@code {
    // Null = håller på att laddas, annars innehåller listan kategorier från API
    private List<CategoryViewModel>? categories = null;

    // Körs automatiskt när sidan laddas
    protected override async Task OnInitializedAsync()
    {
        // Hämtar kategorier från API → CategoriesController → BLL → DAL
        categories = await Http.GetFromJsonAsync<List<CategoryViewModel>>("api/categories");
    }

    // Körs när användaren klickar på ett kort
    private void OnCategoryClick(CategoryViewModel category)
    {
        if (!category.IsLocked)
        {
            // Navigerar till ex. /subcategories/1
            NavigationManager.NavigateTo($"/subcategories/{category.Id}");
        }
    }

    // Lokal modell - måste matcha det som CategoriesController skickar tillbaka
    private class CategoryViewModel
    {
        public int Id { get; set; }
        public string Name { get; set; } = "";
        public bool IsLocked { get; set; }
    }
}